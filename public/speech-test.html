<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Synthesis Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .log {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 20px 0;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Speech Synthesis Test</h1>
    <p>This is a standalone test to verify speech synthesis works on your system.</p>
    
    <button onclick="enableAudio()">🔊 Enable Audio</button>
    <button onclick="testSystemAudio()" id="systemBtn" disabled>🔊 Test System Audio</button>
    <button onclick="resetSpeech()" id="resetBtn" disabled>🔄 Reset Speech</button>
    <button onclick="testHebrew()" id="hebrewBtn" disabled>🎤 Test Hebrew</button>
    <button onclick="testEnglish()" id="englishBtn" disabled>🎤 Test English</button>
    <button onclick="clearLog()">🗑️ Clear Log</button>
    
    <div class="log" id="log"></div>

    <script>
        let audioEnabled = false;

        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function enableAudio() {
            log('🔊 Enabling audio...');
            
            // Test if speech synthesis is available
            if (!('speechSynthesis' in window)) {
                log('❌ Speech synthesis not available in this browser');
                return;
            }

            // Enable test buttons
            document.getElementById('systemBtn').disabled = false;
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('hebrewBtn').disabled = false;
            document.getElementById('englishBtn').disabled = false;
            audioEnabled = true;
            
            log('✅ Audio enabled - test buttons are now active');
            
            // Log available voices
            const voices = speechSynthesis.getVoices();
            log(`📋 Found ${voices.length} available voices`);
            
            const hebrewVoices = voices.filter(v => v.lang.includes('he'));
            log(`🇮🇱 Hebrew voices: ${hebrewVoices.length} found`);
            hebrewVoices.forEach(v => log(`   - ${v.name} (${v.lang})`));
        }

        function testHebrew() {
            if (!audioEnabled) {
                log('❌ Audio not enabled yet');
                return;
            }

            log('🎤 HEBREW TEST: Starting...');
            
            // Cancel any existing speech
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance('שלום עולם');
            utterance.lang = 'he-IL';
            utterance.rate = 0.8;
            utterance.volume = 1.0;
            utterance.pitch = 1.0;

            utterance.onstart = function() {
                log('🎤 ✅ HEBREW: Speech STARTED! You should hear Hebrew now!');
            };

            utterance.onend = function() {
                log('🎤 ✅ HEBREW: Speech ENDED!');
            };

            utterance.onerror = function(event) {
                log(`🎤 ❌ HEBREW: Speech ERROR - ${event.error} at character ${event.charIndex}`);
            };

            // Try to find a Hebrew voice - but also test without specific voice
            const voices = speechSynthesis.getVoices();
            const hebrewVoice = voices.find(voice => 
                voice.lang.includes('he') || 
                voice.name.includes('כרמית') ||
                voice.name.includes('Hebrew')
            );

            if (hebrewVoice) {
                utterance.voice = hebrewVoice;
                log(`🎤 Using Hebrew voice: ${hebrewVoice.name}`);
            } else {
                log('🎤 No Hebrew voice found, using default');
            }

            log('🎤 Calling speechSynthesis.speak()...');
            speechSynthesis.speak(utterance);
            log('🎤 Speech command sent');
            
            // Add timeout to detect silent failure
            setTimeout(function() {
                if (!speechSynthesis.speaking) {
                    log('⚠️ HEBREW: No speech detected after 3 seconds - trying fallback...');
                    testFallback();
                }
            }, 3000);
        }

        function testFallback() {
            log('🔄 FALLBACK TEST: Trying English text with default voice...');
            
            const utterance = new SpeechSynthesisUtterance('Hello world test');
            utterance.volume = 1.0;
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            // No specific voice or language

            utterance.onstart = function() {
                log('🎤 ✅ FALLBACK: Speech STARTED! Basic speech is working!');
            };

            utterance.onend = function() {
                log('🎤 ✅ FALLBACK: Speech ENDED!');
            };

            utterance.onerror = function(event) {
                log(`🎤 ❌ FALLBACK: Speech ERROR - ${event.error}`);
            };

            speechSynthesis.speak(utterance);
            log('🎤 Fallback command sent');
        }

        function testSystemAudio() {
            log('🔊 SYSTEM AUDIO TEST: Testing Web Audio API...');
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        log('🔊 Audio context resumed');
                        playBeep(audioContext);
                    });
                } else {
                    playBeep(audioContext);
                }
                
            } catch (error) {
                log(`🔊 ❌ System audio test failed: ${error.message}`);
            }
        }

        function playBeep(audioContext) {
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4 note
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
                
                log('🔊 ✅ BEEP: System audio should be playing a 440Hz tone!');
                
                setTimeout(() => {
                    log('🔊 System audio test completed');
                }, 600);
                
            } catch (error) {
                log(`🔊 ❌ Beep failed: ${error.message}`);
            }
        }

        function resetSpeech() {
            log('🔄 RESET: Attempting to reset speech synthesis...');
            
            try {
                // Cancel all speech
                speechSynthesis.cancel();
                log('🔄 Canceled all speech');
                
                // Force reload voices
                speechSynthesis.getVoices();
                log('🔄 Reloaded voices');
                
                // Try to trigger voiceschanged event
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = function() {
                        log('🔄 Voices changed event fired');
                        const voices = speechSynthesis.getVoices();
                        log(`🔄 Voices after reset: ${voices.length}`);
                    };
                }
                
                // Try a very simple test after reset
                setTimeout(() => {
                    log('🔄 Testing basic speech after reset...');
                    const utterance = new SpeechSynthesisUtterance('test');
                    
                    utterance.onstart = () => log('🔄 ✅ RESET TEST: Speech started!');
                    utterance.onend = () => log('🔄 ✅ RESET TEST: Speech ended!');
                    utterance.onerror = (e) => log(`🔄 ❌ RESET TEST: Error - ${e.error}`);
                    
                    speechSynthesis.speak(utterance);
                    log('🔄 Reset test command sent');
                }, 1000);
                
            } catch (error) {
                log(`🔄 ❌ Reset failed: ${error.message}`);
            }
        }

        function testEnglish() {
            if (!audioEnabled) {
                log('❌ Audio not enabled yet');
                return;
            }

            log('🎤 ENGLISH TEST: Starting...');
            
            // Cancel any existing speech
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance('Hello world');
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            utterance.volume = 1.0;
            utterance.pitch = 1.0;

            utterance.onstart = function() {
                log('🎤 ✅ ENGLISH: Speech STARTED! You should hear English now!');
            };

            utterance.onend = function() {
                log('🎤 ✅ ENGLISH: Speech ENDED!');
            };

            utterance.onerror = function(event) {
                log(`🎤 ❌ ENGLISH: Speech ERROR - ${event.error} at character ${event.charIndex}`);
            };

            // Try to find an English voice
            const voices = speechSynthesis.getVoices();
            const englishVoice = voices.find(voice => 
                voice.lang.startsWith('en-') && 
                !voice.name.includes('novelty')
            );

            if (englishVoice) {
                utterance.voice = englishVoice;
                log(`🎤 Using English voice: ${englishVoice.name}`);
            } else {
                log('🎤 No English voice found, using default');
            }

            log('🎤 Calling speechSynthesis.speak()...');
            speechSynthesis.speak(utterance);
            log('🎤 Speech command sent');
        }

        // Load voices when page loads
        window.addEventListener('load', function() {
            log('🔄 Page loaded, checking speech synthesis...');
            
            if ('speechSynthesis' in window) {
                log('✅ Speech synthesis is available');
                
                // Wait for voices to load
                if (speechSynthesis.getVoices().length === 0) {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        log('🔄 Voices loaded');
                    });
                } else {
                    log('🔄 Voices already available');
                }
            } else {
                log('❌ Speech synthesis is NOT available in this browser');
            }
        });
    </script>
</body>
</html> 